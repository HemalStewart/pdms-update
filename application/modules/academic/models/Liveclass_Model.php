<?phpif (!defined('BASEPATH'))    exit('No direct script access allowed');class Liveclass_Model extends MY_Model {        function __construct() {        parent::__construct();    }         public function get_live_class_list($class_id = null, $school_id = null, $academic_year_id = null ){                if(!$class_id){           $class_id = $this->session->userdata('class_id');        }                $this->db->select('LC.*, SC.school_name, C.School_className AS class_name, SE.name AS section, S.sub_name AS subject, AY.session_year, T.name AS teacher');        $this->db->from('live_classes AS LC');       // $this->db->join('classes AS C', 'C.id = LC.class_id', 'left');                $this->db->join('schoolclass AS C', 'C.School_classesid = LC.class_id', 'left');        $this->db->join('sections AS SE', 'SE.id = LC.section_id', 'left');//        $this->db->join('subjects AS S', 'S.id = LC.subject_id', 'left');                 $this->db->join('sub_list AS S', 'S.id = LC.subject_id', 'left');        $this->db->join('teachers AS T', 'T.id = LC.teacher_id', 'left');        $this->db->join('academic_years AS AY', 'AY.id = LC.academic_year_id', 'left');        $this->db->join('schools AS SC', 'SC.id = LC.school_id', 'left');                 if ($this->session->userdata('role_id') == ADMIN || $this->session->userdata('role_id') == GUARDIAN || $this->session->userdata('role_id') == STUDENT || $this->session->userdata('role_id') == TEACHER || $this->session->userdata('role_id') == ACCOUNTANT || $this->session->userdata('role_id') == LIBRARIN || $this->session->userdata('role_id') == RECEPTIONIST || $this->session->userdata('role_id') == STAFF) {            $this->db->where('LC.school_id', $this->session->userdata('school_id'));            if ($class_id) {                $this->db->where('LC.class_id', $class_id);            }                         if($this->session->userdata('role_id') == TEACHER){            $this->db->where('LC.teacher_id', $this->session->userdata('profile_id'));        }          } else {////            if ($province_id) {////                $this->db->where('SC.provincial', $province_id);//            }//////            if ($district_id) {////                $this->db->where('SC.district_id', $district_id);//            }//////            if ($zonal_id) {////                $this->db->where('SC.zonal_id', $zonal_id);//            }//////            if ($edu_id) {////                $this->db->where('SC.educational_id', $edu_id);//            }//            if ($school_id) {                  $this->db->where('LC.school_id', $school_id);             }            if ($class_id) {                $this->db->where('LC.class_id', $class_id);            }        }                        if($academic_year_id){            $this->db->where('LC.academic_year_id', $academic_year_id);        }                             if ($this->session->userdata('role_id') == SUBJECT) {            $subject_id = $this->session->userdata('subject_id');            $str_area = explode(',', $subject_id);            $this->db->where_in('LC.subject_id', $str_area);        }        if ($this->session->userdata('role_id') == PROVINCIAL) {            $provincial_id = $this->session->userdata('provincial_id');            $this->db->where('SC.provincial', $provincial_id);        }        if ($this->session->userdata('role_id') == ZONAL) {            $zonal_id = $this->session->userdata('zonal_id');            $str_area = explode(',', $zonal_id);            $this->db->where_in('SC.zonal_id', $str_area);        }             //        if($class_id > 0){////            $this->db->where('LC.class_id', $class_id);            ////        }//        if($school_id && $this->session->userdata('role_id') == SUPER_ADMIN){////            $this->db->where('LC.school_id', $school_id); ////        }         //        if($this->session->userdata('role_id') != SUPER_ADMIN){////            $this->db->where('LC.school_id', $this->session->userdata('school_id'));////        }        $this->db->where('LC.status', 1);                $this->db->order_by('LC.id', 'DESC');        return $this->db->get()->result();            }             public function get_single_live_class($id){                 $this->db->select('LC.*, SC.school_name, C.name AS class_name, SE.name AS section, S.name AS subject, AY.session_year, T.name AS teacher');        $this->db->from('live_classes AS LC');        $this->db->join('classes AS C', 'C.id = LC.class_id', 'left');        $this->db->join('sections AS SE', 'SE.id = LC.section_id', 'left');        $this->db->join('subjects AS S', 'S.id = LC.subject_id', 'left');        $this->db->join('teachers AS T', 'T.id = LC.teacher_id', 'left');        $this->db->join('academic_years AS AY', 'AY.id = LC.academic_year_id', 'left');        $this->db->join('schools AS SC', 'SC.id = LC.school_id', 'left');        $this->db->where('LC.id', $id);        return $this->db->get()->row();            }        function duplicate_check($school_id, $class_id, $section_id = null, $subject_id = null, $teacher_id = null, $class_date = null, $start_time = null, $id = null ){                              if($id){            $this->db->where_not_in('id', $id);        }                $this->db->where('school_id', $school_id);        $this->db->where('class_id', $class_id);        $this->db->where('section_id', $section_id);                      $this->db->where('subject_id', $subject_id);                      $this->db->where('teacher_id', $teacher_id);                      $this->db->where('class_date', $class_date);                      $this->db->where('start_time', $start_time);                              return $this->db->get('live_classes')->num_rows();                }            public function get_student_list($school_id, $class_id, $section_id, $academic_year_id = null ){                $this->db->select('S.email, S.phone, S.name, G.name AS g_name, G.email AS g_email, G.phone AS g_phone');        $this->db->from('enrollments AS E');        $this->db->join('students AS S', 'S.id = E.student_id', 'left');        $this->db->join('guardians AS G', 'G.id = S.guardian_id', 'left');        $this->db->where('E.academic_year_id', $academic_year_id);        $this->db->where('E.class_id', $class_id);        $this->db->where('E.section_id', $class_id);        $this->db->where('E.school_id', $school_id);        $this->db->where('S.status_type', 'regular');                return $this->db->get()->result();            }        public function getclassData($School_TypeId = null) {//        $this->db->select('schoolclass.School_classesid,schoolclass.School_className');        $this->db->from('schoolclass');        $this->db->where('schoolclass.School_Typeid', $School_TypeId);//        $query = $this->db->get();        return $query->result();    }             public function getdistrictData($provincial_id = null) {//        $this->db->select('district.id,district.districtname');        $this->db->from('district');        $this->db->where('district.provinceid', $provincial_id);//        $query = $this->db->get();        return $query->result();    }                public function getzonalData($zonal_id = null) {        $str_area = explode(',', $zonal_id);//        $this->db->select('zoneblock.zoneblockid,zoneblock.zoneblock');        $this->db->from('zoneblock');        $this->db->where_in('zoneblock.zoneid', $str_area);//        $query = $this->db->get();        return $query->result();    }}