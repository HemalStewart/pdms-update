<?phpif (!defined('BASEPATH'))    exit('No direct script access allowed');class Student_Model extends MY_Model {    function __construct() {        parent::__construct();    }    public function get_student_list($class_id = null, $school_id = null, $academic_year_id = null, $province_id = null, $district_id = null, $zonal_id = null, $edu_id = null) {        if (!$class_id) {         //   return;        }        $this->db->select('S.*, SC.school_name, E.roll_no, E.class_id, U.username, U.role_id,  C.School_className AS class_name, SE.name AS section');        $this->db->from('enrollments AS E');        $this->db->join('students AS S', 'S.id = E.student_id', 'left');        $this->db->join('users AS U', 'U.id = S.user_id', 'left');        $this->db->join('schoolclass AS C', 'C.School_classesid = E.class_id', 'left');        $this->db->join('sections AS SE', 'SE.id = E.section_id', 'left');        $this->db->join('schools AS SC', 'SC.id = S.school_id', 'left');                $this->db->join('provincial AS P', 'SC.provincial = P.provincialid', 'left');        $this->db->join('district AS DI', 'SC.district_id = DI.id', 'left');        $this->db->join('zone AS Z', 'SC.zonal_id = Z.zoneid', 'left');        $this->db->join('zoneblock AS ZB', 'SC.educational_id = ZB.zoneblockid', 'left');        if ($academic_year_id) {            $this->db->where('E.academic_year_id', $academic_year_id);        }        if ($class_id) {            $this->db->where('E.class_id', $class_id);        }        if ($this->session->userdata('role_id') == GUARDIAN) {            $this->db->where('S.guardian_id', $this->session->userdata('profile_id'));        }        if ($this->session->userdata('role_id') == STUDENT) {            $this->db->where('S.id', $this->session->userdata('profile_id'));        }        if ($this->session->userdata('role_id') != SUPER_ADMIN) {            $this->db->where('S.school_id', $this->session->userdata('school_id'));        }if ($this->session->userdata('role_id') == ADMIN || $this->session->userdata('role_id') == GUARDIAN || $this->session->userdata('role_id') == STUDENT || $this->session->userdata('role_id') == TEACHER || $this->session->userdata('role_id') == ACCOUNTANT || $this->session->userdata('role_id') == LIBRARIN || $this->session->userdata('role_id') == RECEPTIONIST || $this->session->userdata('role_id') == STAFF || $this->session->userdata('role_id') == PROVINCIAL || $this->session->userdata('role_id') == ZONAL) {            $this->db->where('SC.id', $this->session->userdata('school_id'));        } else {            if ($province_id) {                $this->db->where('SC.provincial', $province_id);            }//            if ($district_id) {                $this->db->where('SC.district_id', $district_id);            }//            if ($zonal_id) {                $this->db->where('SC.zonal_id', $zonal_id);            }//            if ($edu_id) {                $this->db->where('SC.educational_id', $edu_id);            }//            if ($school_id) {////                $this->db->where('SC.id', $school_id);//            }        }        $this->db->where('SC.status', 1);        $this->db->order_by('E.roll_no', 'ASC');        return $this->db->get()->result();    }             public function get_student_sumlist($class_id = null, $school_id = null, $academic_year_id = null) {        if (!$class_id) {            return;        }        $this->db->select('S.*, SC.school_name, E.roll_no, E.class_id, U.username, U.role_id,  C.name AS class_name, SE.name AS section');        $this->db->from('enrollments AS E');        $this->db->join('students AS S', 'S.id = E.student_id', 'left');        $this->db->join('users AS U', 'U.id = S.user_id', 'left');        $this->db->join('schoolclass AS C', 'C.id = E.class_id', 'left');        $this->db->join('sections AS SE', 'SE.id = E.section_id', 'left');        $this->db->join('schools AS SC', 'SC.id = S.school_id', 'left');        if ($academic_year_id) {            $this->db->where('E.academic_year_id', $academic_year_id);        }        if ($class_id) {            $this->db->where('E.class_id', $class_id);        }        if ($this->session->userdata('role_id') == GUARDIAN) {            $this->db->where('S.guardian_id', $this->session->userdata('profile_id'));        }        if ($this->session->userdata('role_id') == STUDENT) {            $this->db->where('S.id', $this->session->userdata('profile_id'));        }        if ($this->session->userdata('role_id') != SUPER_ADMIN) {            $this->db->where('S.school_id', $this->session->userdata('school_id'));        }        if ($school_id && $this->session->userdata('role_id') == SUPER_ADMIN) {            $this->db->where('S.school_id', $school_id);        }        $this->db->where('SC.status', 1);        $this->db->order_by('E.roll_no', 'ASC');        return $this->db->get()->result();    }    public function get_studentall($province_id = null, $district_id = null, $zonal_id = null, $edu_id = null ,$school_id = null ) {        $this->db->select('S.*, SC.school_name, E.roll_no, E.class_id, U.username, U.role_id,  C.name AS class_name, SE.name AS section');        $this->db->from('enrollments AS E');        $this->db->join('students AS S', 'S.id = E.student_id', 'left');        $this->db->join('users AS U', 'U.id = S.user_id', 'left');        $this->db->join('classes AS C', 'C.id = E.class_id', 'left');        $this->db->join('sections AS SE', 'SE.id = E.section_id', 'left');        $this->db->join('schools AS SC', 'SC.id = S.school_id', 'left');        if ($this->session->userdata('role_id') != SUPER_ADMIN) {            $this->db->where('SC.school_id', $this->session->userdata('school_id'));        }                if ($this->session->userdata('role_id') == SUPER_ADMIN && $province_id) {            $this->db->where('SC.provincial', $province_id);        }        if ($this->session->userdata('role_id') == SUPER_ADMIN && $district_id) {            $this->db->where('SC.district_id', $district_id);        }        if ($this->session->userdata('role_id') == SUPER_ADMIN && $zonal_id) {            $this->db->where('SC.zonal_id', $zonal_id);        }        if ($this->session->userdata('role_id') == SUPER_ADMIN && $edu_id) {            $this->db->where('SC.educational_id', $edu_id);        }        if ($this->session->userdata('role_id') == SUPER_ADMIN && $school_id) {            $this->db->where('SC.school_id', $school_id);        }                $this->db->where('SC.status', 1);        $this->db->order_by('E.roll_no', 'ASC');        return $this->db->get()->result();    }    public function get_single_student($id, $academic_year_id) {        $this->db->select('S.*,  SC.school_name, T.type, D.amount, D.title AS discount_title, SC.school_name, G.name as guardian, E.academic_year_id, E.roll_no, E.class_id, E.section_id, U.username, U.role_id, R.name AS role,  C.School_className AS class_name, SE.name AS section, P.provincialname,DI.districtname,Z.zonename,ZB.zoneblock');        $this->db->from('enrollments AS E');        $this->db->join('students AS S', 'S.id = E.student_id', 'left');        $this->db->join('users AS U', 'U.id = S.user_id', 'left');        $this->db->join('roles AS R', 'R.id = U.role_id', 'left');                 $this->db->join('schoolclass AS C', 'C.School_classesid = E.class_id', 'left');     //   $this->db->join('classes AS C', 'C.id = E.class_id', 'left');        $this->db->join('sections AS SE', 'SE.id = E.section_id', 'left');        $this->db->join('guardians AS G', 'G.id = S.guardian_id', 'left');        $this->db->join('schools AS SC', 'SC.id = S.school_id', 'left');        $this->db->join('discounts AS D', 'D.id = S.discount_id', 'left');        $this->db->join('student_types AS T', 'T.id = S.type_id', 'left');        $this->db->join('provincial AS P', 'SC.provincial = P.provincialid', 'left');        $this->db->join('district AS DI', 'SC.district_id = DI.id', 'left');        $this->db->join('zone AS Z', 'SC.zonal_id = Z.zoneid', 'left');        $this->db->join('zoneblock AS ZB', 'SC.educational_id = ZB.zoneblockid', 'left');        $this->db->where('S.id', $id);        $this->db->where('E.academic_year_id', $academic_year_id);        return $this->db->get()->row();    }    public function get_single_guardian($id) {        $this->db->select('G.*, U.username, U.role_id, R.name as role');        $this->db->from('guardians AS G');        $this->db->join('users AS U', 'U.id = G.user_id', 'left');        $this->db->join('roles AS R', 'R.id = U.role_id', 'left');        $this->db->where('G.id', $id);        return $this->db->get()->row();    }    public function get_invoice_list($school_id, $student_id) {        $this->db->select('I.*, SC.school_name,  S.name AS student_name, AY.session_year, C.name AS class_name');        $this->db->from('invoices AS I');        $this->db->join('classes AS C', 'C.id = I.class_id', 'left');        $this->db->join('students AS S', 'S.id = I.student_id', 'left');        $this->db->join('academic_years AS AY', 'AY.id = I.academic_year_id', 'left');        $this->db->join('schools AS SC', 'SC.id = I.school_id', 'left');        $this->db->where('I.invoice_type !=', 'income');        $this->db->where('I.student_id', $student_id);        $this->db->where('I.school_id', $school_id);        $this->db->where('I.paid_status !=', 'paid');        $this->db->where('SC.status', 1);        $this->db->order_by('I.id', 'DESC');        return $this->db->get()->result();    }    public function get_activity_list($student_id) {        $this->db->select('SA.*, ST.name AS student, ST.phone, C.name AS class_name, S.name as section, AY.session_year');        $this->db->from('student_activities AS SA');        $this->db->join('students AS ST', 'ST.id = SA.student_id', 'left');        $this->db->join('classes AS C', 'C.id = SA.class_id', 'left');        $this->db->join('sections AS S', 'S.id = SA.section_id', 'left');        $this->db->join('academic_years AS AY', 'AY.id = SA.academic_year_id', 'left');        $this->db->where('SA.student_id', $student_id);        return $this->db->get()->result();    }    function duplicate_check($username, $id = null) {        if ($id) {            $this->db->where_not_in('id', $id);        }        $this->db->where('username', $username);        return $this->db->get('users')->num_rows();    }    public function get_filterzonalschool($zonal_id = null) {        $str_area = explode(',', $zonal_id);        $this->db->select('SC.*');        $this->db->from('schools AS SC');        $this->db->where('SC.status', 1);        $this->db->where_in('SC.zonal_id', $str_area);        $this->db->order_by('SC.school_name', 'ASC');        return $this->db->get()->result();    }    public function get_student_zonallist($zonal_id = null, $class_id = null, $school_id = null, $academic_year_id = null) {//        if (!$class_id) {            return;        }        $str_area = explode(',', $zonal_id);        $this->db->select('S.*, SC.school_name, E.roll_no, E.class_id, U.username, U.role_id,  C.name AS class_name, SE.name AS section');        $this->db->from('enrollments AS E');        $this->db->join('students AS S', 'S.id = E.student_id', 'left');        $this->db->join('users AS U', 'U.id = S.user_id', 'left');        $this->db->join('classes AS C', 'C.id = E.class_id', 'left');        $this->db->join('sections AS SE', 'SE.id = E.section_id', 'left');        $this->db->join('schools AS SC', 'SC.id = S.school_id', 'left');//        if ($academic_year_id) {////            $this->db->where('E.academic_year_id', $academic_year_id);//        }        if ($class_id) {            $this->db->where('E.class_id', $class_id);        }        $this->db->where('SC.status', 1);        $this->db->where_in('SC.zonal_id', $str_area);        $this->db->order_by('E.roll_no', 'ASC');        return $this->db->get()->result();    }    public function get_student_provinciallist($provincial_id = null, $class_id = null, $school_id = null, $academic_year_id = null) {//        if (!$class_id) {            return;        }        $this->db->select('S.*, SC.school_name, E.roll_no, E.class_id, U.username, U.role_id,  C.name AS class_name, SE.name AS section');        $this->db->from('enrollments AS E');        $this->db->join('students AS S', 'S.id = E.student_id', 'left');        $this->db->join('users AS U', 'U.id = S.user_id', 'left');        $this->db->join('classes AS C', 'C.id = E.class_id', 'left');        $this->db->join('sections AS SE', 'SE.id = E.section_id', 'left');        $this->db->join('schools AS SC', 'SC.id = S.school_id', 'left');        if ($class_id) {            $this->db->where('E.class_id', $class_id);        }        if ($school_id && $this->session->userdata('role_id') == PROVINCIAL) {            $this->db->where('S.school_id', $school_id);        }        //  $this->db->where('SC.status', 1);        $this->db->where('SC.provincial', $provincial_id);        $this->db->order_by('E.roll_no', 'ASC');        return $this->db->get()->result();    }    public function getdistrictData($provincial_id = null) {//        $this->db->select('district.id,district.districtname');        $this->db->from('district');        $this->db->where('district.provinceid', $provincial_id);//        $query = $this->db->get();        return $query->result();    }           public function getclassData($School_TypeId = null) {//        $this->db->select('schoolclass.School_classesid,schoolclass.School_className');        $this->db->from('schoolclass');        $this->db->where('schoolclass.School_Typeid', $School_TypeId);//        $query = $this->db->get();        return $query->result();    }}